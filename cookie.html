<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cookie Consent Demo</title>
  <style>
    /* Basic page style for demo */
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; min-height:100vh; }

    /* Banner container (fixed bottom) */
    .cookie-banner {
      position: fixed;
      left: 1rem;
      right: 1rem;
      bottom: 1rem;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 1rem;
      align-items: center;
      padding: 1rem 1.1rem;
      background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,250,0.98));
      border-radius: 12px;
      box-shadow: 0 6px 28px rgba(0,0,0,0.16);
      border: 1px solid rgba(0,0,0,0.06);
      transform: translateY(20px);
      opacity: 0;
      transition: transform .28s ease, opacity .28s ease;
      z-index: 9999;
      max-width: 980px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Visible state */
    .cookie-banner.show {
      transform: translateY(0);
      opacity: 1;
    }

    .cookie-banner p {
      margin: 0;
      font-size: 0.95rem;
      color: #111827;
      line-height: 1.3;
    }

    .cookie-actions {
      display: flex;
      gap: 0.6rem;
      align-items: center;
    }

    /* Buttons */
    .btn {
      padding: 0.55rem 0.9rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      font-size: 0.9rem;
    }

    .btn-accept {
      background: #6b46c1; /* purple-ish */
      color: white;
      box-shadow: 0 6px 18px rgba(107,70,193,0.18);
    }

    .btn-manage {
      background: transparent;
      color: #374151;
      border: 1px solid rgba(55,65,81,0.12);
    }

    /* Small screens: stack */
    @media (max-width:640px) {
      .cookie-banner { grid-template-columns: 1fr; gap: 0.75rem; bottom: 0.6rem; left: 0.6rem; right: 0.6rem; padding: 0.9rem; }
      .cookie-actions { justify-content: stretch; }
      .btn { width: 100%; }
      .btn-manage { order: -1; } /* show manage before accept on mobile if desired */
    }
  </style>
</head>
<body>

  <main style="padding:2rem;">
    <h1>Website content</h1>
    <p>Demo page — cookie consent banner appears on first visit.</p>
  </main>

  <!-- Cookie banner -->
  <div id="cookieBanner" class="cookie-banner" role="dialog" aria-live="polite" aria-label="Cookie consent">
    <div>
      <p><strong>We use cookies</strong> to improve your experience, personalize content and analyze traffic. By clicking "Accept all" you agree to the use of cookies. <a href="/privacy" aria-label="Privacy policy (opens in same tab)">Learn more</a>.</p>
    </div>

    <div class="cookie-actions" aria-hidden="false">
      <button id="manageBtn" class="btn btn-manage" type="button" aria-controls="cookieBanner">Manage</button>
      <button id="acceptBtn" class="btn btn-accept" type="button">Accept all</button>
    </div>
  </div>

  <script>
    (function () {
      const KEY = 'site_cookie_consent_v1'; // increment when your consent schema changes
      const banner = document.getElementById('cookieBanner');
      const acceptBtn = document.getElementById('acceptBtn');
      const manageBtn = document.getElementById('manageBtn');

      // Utility: read stored consent
      function getConsent() {
        try {
          return JSON.parse(localStorage.getItem(KEY));
        } catch (e) { return null; }
      }

      // Utility: store consent
      function setConsent(payload) {
        try {
          localStorage.setItem(KEY, JSON.stringify(payload));
        } catch (e) {
          // fallback: cookies (1 year)
          const val = encodeURIComponent(JSON.stringify(payload));
          document.cookie = KEY + '=' + val + '; path=/; max-age=' + (60*60*24*365);
        }
      }

      // Simple function to apply when cookies accepted
      function enableAllCookies() {
        // Place logic to initialize analytics, A/B, tracking etc. here.
        // Example: loadAnalytics(); loadApm(); enableThirdPartyWidgets();
        // This demo just logs:
        console.info('All cookies accepted — enable trackers now if any.');
      }

      // Hide banner
      function hideBanner() {
        banner.classList.remove('show');
        // keep it out of the accessibility tree
        banner.setAttribute('aria-hidden', 'true');
      }

      // Show banner
      function showBanner() {
        banner.classList.add('show');
        banner.setAttribute('aria-hidden', 'false');
      }

      // Initial check
      const consent = getConsent();
      if (!consent || !consent.accepted) {
        // No consent stored — show the banner
        // Defer to next animation frame to allow CSS transition
        requestAnimationFrame(() => showBanner());
      } else {
        // Already accepted previously — optionally re-enable features
        if (consent.accepted && consent.type === 'all') {
          enableAllCookies();
        }
      }

      // User clicks Accept all
      acceptBtn.addEventListener('click', function () {
        const payload = {
          accepted: true,
          type: 'all',
          timestamp: new Date().toISOString()
        };
        setConsent(payload);
        enableAllCookies();
        hideBanner();
      });

      // Manage button (example: open a simple preferences modal)
      manageBtn.addEventListener('click', function () {
        // For demo we simply show a confirm prompt. Replace this with a real modal for granular choices.
        const allowAnalytics = confirm('Allow analytics cookies? (OK = allow)');
        const payload = {
          accepted: allowAnalytics,
          type: allowAnalytics ? 'analytics' : 'necessary',
          timestamp: new Date().toISOString()
        };
        setConsent(payload);

        if (allowAnalytics) enableAllCookies();
        hideBanner();
      });

      // Accessibility: close on Escape
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && banner.classList.contains('show')) {
          hideBanner();
        }
      });

      // OPTIONAL: if you want to expose a method to check consent from other scripts:
      window.getCookieConsent = getConsent;
    })();
  </script>
</body>
</html>
